<html>

  <head>
    <title>What Do You Know About Pollution?</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <style>
        .axis text {
          font: 10px sans-serif;
          stroke: #d3d6d8;
        }

        .axis line, .axis path {
          fill: none;
          stroke: #d3d6d8;


        }

        .arc text {
          font: 20px sans-serif;
          text-anchor: middle;
        }

        .arc path {
          stroke: #fff;
        }

        svg{
          padding-left: 50px;
        }

        /* Tooltip CSS */
        #tooltip {
          line-height: 1.5;
          font-weight: 400;
          font-family:"avenir next", Arial, sans-serif;
          padding: 6px;
          background: rgba(0, 0, 0, 0.6);
          color: #7C93DA;
          border-radius: 1px;
          pointer-events: none;
        }

        .details{
          color:white;
        }

        div.content {
          padding-left: 100px;
          padding-right: 100px;
        }

        h4.subtitle {
          color: #d3d6d8;

        }

        h4.text {
          color: #d3d6d8;

        }

        h4.source {
          color: #d3d6d8;
          text-align: right;
        }

        h4.source2 {
          color: #d3d6d8;
          text-align: center;
        }

        h4.pietitle {
          color: #d3d6d8;
          text-align: center;
        }

        h1.data {
          color: white;
          text-align: center;
        }

        h4.dataex {
          color: #d3d6d8;
          text-align: center;
        }

        h1.title {
          color: white;

        }

        h1.impt {
          color: white;

        }

        .content {
        	text-align: left;
        	margin: .5em 0;
        }

        .content2 {
        	text-align: center;
        	margin: .5em 0;
        }

        div.one-third {
          width:33.33%;
          float:left;
          padding-right: 0px;
        }



    </style>

  </head>

  <body style="background-color:#353535;">
    <div class="content">
        <br>

        <h4 class="subtitle">What Do People Know About</h4>
        <h1 class="title">POLLUTION</h1>
        <hr>

        <h4 class="subtitle">Pollution Index By TOP 100 Countries 2018</h4>
        <h4 class="source">Made by Jieru Xu. <a href="https://www.numbeo.com">Soure: www.numbeo.com</a></h4>
    </div>

        <div id="tooltip"></div>

        <svg id="map" width=1300 height=1000>
          <rect width=1300 height=1000 fill="#353535"></rect>
        </svg>

        <div id="legend1"></div>
        <br>
        <br>
        <hr>
        <br>
      <div class="content2">
        <div class="one-third">
          <h4 class="text">More than</h4>
          <h1 class="impt">1 billion</h1>
          <h4 class="text">people worldwide don't have access to safe <br> drinking water.</h4>
          <br>

          <h4 class="text"><br>People who live in places with high levels of<br>  air pollutants have a </h4>
          <h1 class="impt">20%</h1>
          <h4 class="text">higher risk of death from lung cancer than <br> people who live in less-polluted areas.</h4>
          <br>

          <h4 class="text"><br>In America alone 3 million plastic bottles <br> are thrown away every hour. However, it takes up to</h4>
          <h1 class="impt">500 years</h1>
          <h4 class="text">for the plastic bottle to decompose.</h4>
          <br>

          <h4 class="text"><br>Landflls are among the biggest contributors<br> to soil pollution. About</h4>
          <h1 class="impt">80%</h1>
          <h4 class="text">of the items buried in landflls could be recycled.</h4>
          <br>
          <br>
        </div>

        <div class="one-third">
          <h4 class="text">Approximately</h4>
          <h1 class="impt">40%</h1>
          <h4 class="text">of the lakes in America are too polluted for <br> fshing, aquatic life, or swimming.</h4>
          <br>

          <h4 class="text"><br>Each year</h4>
          <h1 class="impt">1.2 trillion gallons</h1>
          <h4 class="text"><br>of untreated sewage, stormwater, and industrial <br> waste are dumped into US water.</h4>
          <br>

          <h4 class="text"><br>Every year, more than</h4>
          <h1 class="impt">14 billion pounds</h1>
          <h4 class="text">of untreated sewage, stormwater, and industrial <br> waste are dumped into US water.</h4>
          <br>

          <h4 class="text"><br>Pollution kills more than</h4>
          <h1 class="impt">1 million</h1>
          <h4 class="text"><br>seabirds and 100 million mammals every year.</h4>
          <br>
          <br>

        </div>

        <div class="one-third">

          <h4 class="pietitle">Types of Emission sources and their<br>contribution to pollution in percentage</h4>
          <div id="pie"></div>
          <h4 class="source2">Soure: www.kued.org</h4>

          <h1 class="impt"><br>57% Vehicles (cars, trucks, planes, lawnmowers, etc.)
            <br><br> 32% Buildings (Homes, small businesses, restaurants, aerosol products, etc.)
            <br><br> 11% Industry (Mines, refneries, large industry, etc)
          </h1>



        </div>

        </div>
    </div>


  </body>

  <script type="text/javascript">

      var tip = d3.select("#tooltip")
        .style("position", "absolute")
        .style("opacity", 0);

      var margin = {top: 0, right: 0, bottom: 0, left: 0},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

      var w = 400, h = 50;

      var key = d3.select("#legend1")
        .append("svg")
        .attr("width", w)
        .attr("height", h);

      var legend = key.append("defs")
        .append("svg:linearGradient")
        .attr("id", "gradient")
        .attr("x1", "0%")
        .attr("y1", "100%")
        .attr("x2", "100%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");

      legend.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", "#E8C962")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "33%")
        .attr("stop-color", "#E7A757")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "66%")
        .attr("stop-color", "#EC7D4F")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "100%")
        .attr("stop-color", "#B71D3E")
        .attr("stop-opacity", 1);

      key.append("rect")
        .attr("width", w)
        .attr("height", h - 30)
        .style("fill", "url(#gradient)")
        .attr("transform", "translate(0,10)");

      var y = d3.scaleLinear()
        .range([400, 0])
        .domain([92.03, 12.07]);

      var yAxis = d3.axisBottom()
        .scale(y)
        .ticks(5);

      key.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(0,30)")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("");

      //loading data
      d3.queue()
        .defer(d3.json, "world.json")
        .defer(d3.csv, "pollution_index.csv")
        .awaitAll(function(error, dataArray){
          var pollutionData = dataArray[1];
          var data = dataArray[0];
          console.log(dataArray);

          pollutionData.forEach(function(country) {
            country.pollution = parseFloat(country.pollution);
          });
          console.log(pollutionData);
          var geoJSON = topojson.feature(data, data.objects.countries);

          geoJSON.features = geoJSON.features.filter(function(feature) {
            return feature.id != "AQ";
          });

          var proj = d3.geoMercator()
             .fitSize([1200, 1000], geoJSON);

          var path = d3.geoPath()
             .projection(proj);

          var colorScale = d3.scaleLinear()
             .domain([12.07, 92.03])
             .range(["#E8C962", "#B71D3E"]);

          var countryLookup = {
             RU: "Russia",
             US: "United States",
             IT: "Italy",
             GT: "Great Britain",
             DE: "Germany",
             PL: "Poland",
             CN: "China",
             JP: "Japan",
             UA: "Ukraine",
             CA: "Canada",
             IL: "Israel",
             LT: "Lithuania",
             TW: "Taiwan",
             AT: "Austria",
             LV: "Latvia",
             KR: "South Korea",
             NL: "Netherlands",
             HK: "Hong Kong",
             AF: "Afghanistan",
             AL: "Albania",
             DZ: "Algeria",
             AR: "Argentina",
             AM: "Armenia",
             AU: "Australia",
             BH: "Bahrain",
             BD: "Bangladesh",
             BY: "Belarus",
             BE: "Belgium",
             BA: "Bosnia and Herzegovina",
             BR: "Brazil",
             BG: "Bulgaria",
             KH: "Cambodia",
             CL: "Chile",
             CO: "Colombia",
             CR: "Costa Rica",
             DO: "Dominican Republic",
             EC: "Ecuador",
             EG: "Egypt",
             EE: "Estonia",
             ET: "Ethiopia",
             FI: "Finland",
             FR: "France",
             GE: "Georgia",
             GR: "Greece",
             HU: "Hungary",
             IS: "Iceland",
             IN: "India",
             ID: "Indonesia",
             IR: "Iran",
             IQ: "Iraq",
             IE: "Ireland",
             JM: "Jamaica",
             JO: "Jordan",
             KZ: "Kazakhstan",
             KE: "Kenya",
             LB: "Lebanon",
             MK: "Macedonia",
             MY: "Malaysia",
             MT: "Malta",
             MU: "Mauritius",
             MX: "Mexico",
             MC: "Monaco",
             MN: "Mongolia",
             MA: "Morocco",
             MM: "Myanmar",
             NP: "Nepal",
             NZ: "New Zealand",
             NG: "Nigeria",
             NO: "Norway",
             OM: "Oman",
             PK: "Pakistan",
             PA: "Panama",
             PE: "Peru",
             PH: "Philippines",
             PT: "Portugal",
             QA: "Qatar",
             RO: "Romania",
             SA: "Saudi Arabia",
             RS: "Serbia",
             SG: "Singapore",
             SK: "Slovakia",
             SI: "Slovenia",
             ZA: "South Africa",
             ES: "Spain",
             LK: "Sri Lanka",
             SE: "Sweden",
             CH: "Switzerland",
             TH: "Thailand",
             TN: "Tunisia",
             TR: "Turkey",
             AE: "United Arab Emirates",
             UY: "Uruguay",
             VE: "Venezuela",
             VN: "Vietnam"

           };

          var countries = d3.select("#map").selectAll("path")
              .data(geoJSON.features);

          countries.enter().append("path")
            .attr("fill", function(d) {
              var countryName = countryLookup[d.id];
              if (countryName == undefined) {
                return "black";
              }
              if (countryName.length == 0) {
                return "black";
              }
              var countryData = pollutionData.filter(function(d) { return d.country == countryName; });
              console.log(d.id, countryName, countryData);
              return colorScale(countryData[0].pollution);
            })
            .attr("stroke", "gray")
            .attr("stroke-width", 1)
            .attr("d", function(feature) {
              return path(feature);
            })
            .on('mousemove',function(d){

              var countryName = countryLookup[d.id];
              if (countryName == undefined) {
                return;
              }
              var countryData = pollutionData.filter(function(d) { return d.country == countryName; });

              tip
                .html("<strong>Country: </strong> <span class='details'>" + countryData[0].country +
                "<br></span>" + "<strong>index: </strong><span class='details'>" + countryData[0].pollution +"</span>")
                .style("opacity", 1)
                .style("left", d3.event.pageX + "px")
                .style("top", d3.event.pageY - 50 + "px");

              d3.select(this)

                .style("opacity", 1)
                .style("stroke","white")
                .style("stroke-width",3);
            })
            .on('mouseout', function(d){
              tip.style("opacity", 0);

              d3.select(this)
                .style("opacity", 0.8)
                .style("stroke","white")
                .style("stroke-width",0.3);
            });

        });

        var data = [11, 32, 57];

        var width = 300,
            height = 300,
            radius = Math.min(width, height) / 2;

        var color = d3.scaleOrdinal()
            .range(["#edc55f", "#db5e44", "#b81f3f"]);

        var arc = d3.arc()
            .outerRadius(radius - 10)
            .innerRadius(0);

        var labelArc = d3.arc()
            .outerRadius(radius - 40)
            .innerRadius(radius - 40);

        var pie = d3.pie()
            .sort(null)
            .value(function(d) { return d; });

        var svg = d3.select("#pie").append("svg")
            .attr("width", width)
            .attr("height", height)
          .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

          var g = svg.selectAll(".arc")
              .data(pie(data))
            .enter().append("g")
              .attr("class", "arc");

          g.append("path")
              .attr("d", arc)
              .style("fill", function(d) { return color(d.data); });

          g.append("text")
              .attr("transform", function(d) { return "translate(" + labelArc.centroid(d) + ")"; })
              .attr("dy", ".35em")
              .text(function(d) { return d.data; });



  </script>




</html>
