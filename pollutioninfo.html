<html>

  <head>
    <title>What Do You Know About Pollution?</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <style>
        .axis text {
          font: 10px sans-serif;
          stroke: #d3d6d8;
        }

        .axis line, .axis path {
          fill: none;
          stroke: #d3d6d8;


        }

        .arc text {
          font: 20px sans-serif;
          text-anchor: middle;
        }

        .arc path {
          stroke: #fff;
        }

        svg{
          padding-left: 50px;
        }

        /* Tooltip CSS */
        #tooltip {
          line-height: 1.5;
          font-weight: 400;
          font-family:"avenir next", Arial, sans-serif;
          padding: 6px;
          background: rgba(0, 0, 0, 0.6);
          color: #7C93DA;
          border-radius: 1px;
          pointer-events: none;
        }

        .details{
          color:white;
        }

        div.content {
          padding-left: 100px;
          padding-right: 100px;
        }

        h4.subtitle {
          color: #d3d6d8;

        }

        h4.text {
          color: #d3d6d8;

        }

        h4.source {
          color: #d3d6d8;
          text-align: right;
        }

        h4.source2 {
          color: #d3d6d8;
          text-align: center;
        }

        h4.pietitle {
          color: #d3d6d8;
          text-align: center;
        }

        h1.data {
          color: white;
          text-align: center;
        }

        h4.dataex {
          color: #d3d6d8;
          text-align: center;
        }

        h1.title {
          color: white;

        }

        h1.impt {
          color: white;

        }

        .content {
        	text-align: left;
        	margin: .5em 0;
        }

        .content2 {
        	text-align: center;
        	margin: .5em 0;
        }

        div.one-third {
          width:33.33%;
          float:left;
          padding-right: 0px;
        }


        /* <* pie new *> */
        .legend {
          font-size: 14px;
        }
        rect {
          cursor: pointer;
          stroke-width: 2;
        }
        rect.disabled {
          fill: transparent !important;
        }

        /* chart */
        #chart {
          height: 800px;
          margin: 0 auto;
          position: relative;
          display: block;
          width: 1200px;
        }

        /* tooltip */
        .tooltip {
          background: #eee;
          box-shadow: 0 0 5px #999999;
          color: #333;
          display: none;
          font-size: 18px;
          left: 130px;
          padding: 10px;
          position: absolute;
          text-align: center;
          top: 95px;
          width: 80px;
          z-index: 10;
        }

        .footer {
          padding-top: 50px;
          text-align: center;
          list-style-type: none;
        }


    </style>

  </head>

  <body style="background-color:#353535;">
    <div class="content">
        <br>

        <h4 class="subtitle">What Do People Know About</h4>
        <h1 class="title">POLLUTION</h1>
        <hr>

        <h4 class="subtitle">Pollution Index By TOP 100 Countries 2018</h4>
        <h4 class="source">Made by Jieru Xu. <a href="https://www.numbeo.com">Soure: www.numbeo.com</a></h4>
    </div>

        <div id="tooltip"></div>

        <svg id="map" width=1300 height=1000>
          <rect width=1300 height=1000 fill="#353535"></rect>
        </svg>

        <div id="legend1"></div>
        <br>
        <br>
        <hr>
        <br>
      <div class="content2">
        <div class="one-third">
          <h4 class="text">More than</h4>
          <h1 class="impt">1 billion</h1>
          <h4 class="text">people worldwide don't have access to safe <br> drinking water.</h4>
          <br>

          <h4 class="text"><br>People who live in places with high levels of<br>  air pollutants have a </h4>
          <h1 class="impt">20%</h1>
          <h4 class="text">higher risk of death from lung cancer than <br> people who live in less-polluted areas.</h4>
          <br>

          <h4 class="text"><br>In America alone 3 million plastic bottles <br> are thrown away every hour. However, it takes up to</h4>
          <h1 class="impt">500 years</h1>
          <h4 class="text">for the plastic bottle to decompose.</h4>
          <br>

          <h4 class="text"><br>Landflls are among the biggest contributors<br> to soil pollution. About</h4>
          <h1 class="impt">80%</h1>
          <h4 class="text">of the items buried in landflls could be recycled.</h4>
          <br>
          <br>
        </div>

        <div class="one-third">
          <h4 class="text">Approximately</h4>
          <h1 class="impt">40%</h1>
          <h4 class="text">of the lakes in America are too polluted for <br> fshing, aquatic life, or swimming.</h4>
          <br>

          <h4 class="text"><br>Each year</h4>
          <h1 class="impt">1.2 trillion gallons</h1>
          <h4 class="text"><br>of untreated sewage, stormwater, and industrial <br> waste are dumped into US water.</h4>
          <br>

          <h4 class="text"><br>Every year, more than</h4>
          <h1 class="impt">14 billion pounds</h1>
          <h4 class="text">of untreated sewage, stormwater, and industrial <br> waste are dumped into US water.</h4>
          <br>

          <h4 class="text"><br>Pollution kills more than</h4>
          <h1 class="impt">1 million</h1>
          <h4 class="text"><br>seabirds and 100 million mammals every year.</h4>
          <br>
          <br>

        </div>

        <div class="one-third">

          <h4 class="pietitle">Types of Emission sources and their<br>contribution to pollution in percentage</h4>
          <div id="mychart"></div>
          <h4 class="source2">Soure: www.kued.org</h4>

          <h1 class="impt"><br>57% Vehicles (cars, trucks, planes, lawnmowers, etc.)
            <br><br> 32% Buildings (Homes, small businesses, restaurants, aerosol products, etc.)
            <br><br> 11% Industry (Mines, refneries, large industry, etc)
          </h1>



        </div>

        </div>
    </div>


  </body>

  <script type="text/javascript">

      var tip = d3.select("#tooltip")
        .style("position", "absolute")
        .style("opacity", 0);

      var margin = {top: 0, right: 0, bottom: 0, left: 0},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

      var w = 400, h = 50;

      var key = d3.select("#legend1")
        .append("svg")
        .attr("width", w)
        .attr("height", h);

      var legend = key.append("defs")
        .append("svg:linearGradient")
        .attr("id", "gradient")
        .attr("x1", "0%")
        .attr("y1", "100%")
        .attr("x2", "100%")
        .attr("y2", "100%")
        .attr("spreadMethod", "pad");

      legend.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", "#E8C962")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "33%")
        .attr("stop-color", "#E7A757")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "66%")
        .attr("stop-color", "#EC7D4F")
        .attr("stop-opacity", 1);

      legend.append("stop")
        .attr("offset", "100%")
        .attr("stop-color", "#B71D3E")
        .attr("stop-opacity", 1);

      key.append("rect")
        .attr("width", w)
        .attr("height", h - 30)
        .style("fill", "url(#gradient)")
        .attr("transform", "translate(0,10)");

      var y = d3.scaleLinear()
        .range([400, 0])
        .domain([92.03, 12.07]);

      var yAxis = d3.axisBottom()
        .scale(y)
        .ticks(5);

      key.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(0,30)")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("");

      //loading data
      d3.queue()
        .defer(d3.json, "world.json")
        .defer(d3.csv, "pollution_index.csv")
        .awaitAll(function(error, dataArray){
          var pollutionData = dataArray[1];
          var data = dataArray[0];
          console.log(dataArray);

          pollutionData.forEach(function(country) {
            country.pollution = parseFloat(country.pollution);
          });
          console.log(pollutionData);
          var geoJSON = topojson.feature(data, data.objects.countries);

          geoJSON.features = geoJSON.features.filter(function(feature) {
            return feature.id != "AQ";
          });

          var proj = d3.geoMercator()
             .fitSize([1200, 1000], geoJSON);

          var path = d3.geoPath()
             .projection(proj);

          var colorScale = d3.scaleLinear()
             .domain([12.07, 92.03])
             .range(["#E8C962", "#B71D3E"]);

          var countryLookup = {
             RU: "Russia",
             US: "United States",
             IT: "Italy",
             GT: "Great Britain",
             DE: "Germany",
             PL: "Poland",
             CN: "China",
             JP: "Japan",
             UA: "Ukraine",
             CA: "Canada",
             IL: "Israel",
             LT: "Lithuania",
             TW: "Taiwan",
             AT: "Austria",
             LV: "Latvia",
             KR: "South Korea",
             NL: "Netherlands",
             HK: "Hong Kong",
             AF: "Afghanistan",
             AL: "Albania",
             DZ: "Algeria",
             AR: "Argentina",
             AM: "Armenia",
             AU: "Australia",
             BH: "Bahrain",
             BD: "Bangladesh",
             BY: "Belarus",
             BE: "Belgium",
             BA: "Bosnia and Herzegovina",
             BR: "Brazil",
             BG: "Bulgaria",
             KH: "Cambodia",
             CL: "Chile",
             CO: "Colombia",
             CR: "Costa Rica",
             DO: "Dominican Republic",
             EC: "Ecuador",
             EG: "Egypt",
             EE: "Estonia",
             ET: "Ethiopia",
             FI: "Finland",
             FR: "France",
             GE: "Georgia",
             GR: "Greece",
             HU: "Hungary",
             IS: "Iceland",
             IN: "India",
             ID: "Indonesia",
             IR: "Iran",
             IQ: "Iraq",
             IE: "Ireland",
             JM: "Jamaica",
             JO: "Jordan",
             KZ: "Kazakhstan",
             KE: "Kenya",
             LB: "Lebanon",
             MK: "Macedonia",
             MY: "Malaysia",
             MT: "Malta",
             MU: "Mauritius",
             MX: "Mexico",
             MC: "Monaco",
             MN: "Mongolia",
             MA: "Morocco",
             MM: "Myanmar",
             NP: "Nepal",
             NZ: "New Zealand",
             NG: "Nigeria",
             NO: "Norway",
             OM: "Oman",
             PK: "Pakistan",
             PA: "Panama",
             PE: "Peru",
             PH: "Philippines",
             PT: "Portugal",
             QA: "Qatar",
             RO: "Romania",
             SA: "Saudi Arabia",
             RS: "Serbia",
             SG: "Singapore",
             SK: "Slovakia",
             SI: "Slovenia",
             ZA: "South Africa",
             ES: "Spain",
             LK: "Sri Lanka",
             SE: "Sweden",
             CH: "Switzerland",
             TH: "Thailand",
             TN: "Tunisia",
             TR: "Turkey",
             AE: "United Arab Emirates",
             UY: "Uruguay",
             VE: "Venezuela",
             VN: "Vietnam"

           };

          var countries = d3.select("#map").selectAll("path")
              .data(geoJSON.features);

          countries.enter().append("path")
            .attr("fill", function(d) {
              var countryName = countryLookup[d.id];
              if (countryName == undefined) {
                return "black";
              }
              if (countryName.length == 0) {
                return "black";
              }
              var countryData = pollutionData.filter(function(d) { return d.country == countryName; });
              console.log(d.id, countryName, countryData);
              return colorScale(countryData[0].pollution);
            })
            .attr("stroke", "gray")
            .attr("stroke-width", 1)
            .attr("d", function(feature) {
              return path(feature);
            })
            .on('mousemove',function(d){

              var countryName = countryLookup[d.id];
              if (countryName == undefined) {
                return;
              }
              var countryData = pollutionData.filter(function(d) { return d.country == countryName; });

              tip
                .html("<strong>Country: </strong> <span class='details'>" + countryData[0].country +
                "<br></span>" + "<strong>index: </strong><span class='details'>" + countryData[0].pollution +"</span>")
                .style("opacity", 1)
                .style("left", d3.event.pageX + "px")
                .style("top", d3.event.pageY - 50 + "px");

              d3.select(this)

                .style("opacity", 1)
                .style("stroke","white")
                .style("stroke-width",3);
            })
            .on('mouseout', function(d){
              tip.style("opacity", 0);

              d3.select(this)
                .style("opacity", 0.8)
                .style("stroke","white")
                .style("stroke-width",0.3);
            });

        });

// pie
// define data
        var dataset = [
        {label: "Vehicles", count: 57},
        {label: "Buildings", count: 32},
        {label: "Industry", count: 11}

        ];

        // chart dimensions
        var width = 300;
        var height = 300;

        // a circle chart needs a radius
        var radius = Math.min(width, height) / 2;

        // legend dimensions
        var legendRectSize = 25; // defines the size of the colored squares in legend
        var legendSpacing = 6; // defines spacing between squares

        // define color scale
        var color = d3.scaleOrdinal()
        .range(["#b81f3f", "#db5e44", "#edc55f"]);

        var svg = d3.select('#mychart') // select element in the DOM with id 'mychart'
        .append('svg') // append an svg element to the element we've selected
        .attr('width', width) // set the width of the svg element we just added
        .attr('height', height) // set the height of the svg element we just added
        .append('g') // append 'g' element to the svg element
        .attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')'); // our reference is now to the 'g' element. centerting the 'g' element to the svg element

        var arc = d3.arc()
        .innerRadius(0) // none for pie
        .outerRadius(radius); // size of overall chart

        var pie = d3.pie() // start and end angles of the segments
        .value(function(d) { return d.count; }) // how to extract the numerical data from each entry in our dataset
        .sort(null); // by default, data sorts in oescending value. this will mess with our animation so we set it to null

        // define tooltip
        var tooltip = d3.select('#mychart') // select element in the DOM with id 'chart'
        .append('div') // append a div element to the element we've selected
        .attr('class', 'tooltip'); // add class 'tooltip' on the divs we just selected

        tooltip.append('div') // add divs to the tooltip defined above
        .attr('class', 'label'); // add class 'label' on the selection

        tooltip.append('div') // add divs to the tooltip defined above
        .attr('class', 'count'); // add class 'count' on the selection

        tooltip.append('div') // add divs to the tooltip defined above
        .attr('class', 'percent'); // add class 'percent' on the selection

        // Confused? see below:

        // <div id="chart">
        //   <div class="tooltip">
        //     <div class="label">
        //     </div>
        //     <div class="count">
        //     </div>
        //     <div class="percent">
        //     </div>
        //   </div>
        // </div>

        dataset.forEach(function(d) {
        d.count = +d.count; // calculate count as we iterate through the data
        d.enabled = true; // add enabled property to track which entries are checked
        });

        // creating the chart
        var path = svg.selectAll('path') // select all path elements inside the svg. specifically the 'g' element. they don't exist yet but they will be created below
        .data(pie(dataset)) //associate dataset wit he path elements we're about to create. must pass through the pie function. it magically knows how to extract values and bakes it into the pie
        .enter() //creates placeholder nodes for each of the values
        .append('path') // replace placeholders with path elements
        .attr('d', arc) // define d attribute with arc function above
        .attr('fill', function(d) { return color(d.data.label); }) // use color scale to define fill of each label in dataset
        .each(function(d) { this._current - d; }); // creates a smooth animation for each track

        // mouse event handlers are attached to path so they need to come after its definition
        path.on('mouseover', function(d) {  // when mouse enters div
        var total = d3.sum(dataset.map(function(d) { // calculate the total number of tickets in the dataset
        return (d.enabled) ? d.count : 0; // checking to see if the entry is enabled. if it isn't, we return 0 and cause other percentages to increase
        }));
        var percent = Math.round(1000 * d.data.count / total) / 10; // calculate percent
        tooltip.select('.label').html(d.data.label); // set current label
        tooltip.select('.percent').html(percent + '%'); // set percent calculated above
        tooltip.style('display', 'block'); // set display
        });

        path.on('mouseout', function() { // when mouse leaves div
        tooltip.style('display', 'none'); // hide tooltip for that element
        });

        path.on('mousemove', function(d) { // when mouse moves
        tooltip.style('top', (d3.event.layerY + 10) + 'px') // always 10px below the cursor
        .style('left', (d3.event.layerX + 10) + 'px'); // always 10px to the right of the mouse
        });

        // define legend
        var legend = svg.selectAll('.legend') // selecting elements with class 'legend'
        .data(color.domain()) // refers to an array of labels from our dataset
        .enter() // creates placeholder
        .append('g') // replace placeholders with g elements
        .attr('class', 'legend') // each g is given a legend class
        .attr('transform', function(d, i) {
        var height = legendRectSize + legendSpacing; // height of element is the height of the colored square plus the spacing
        var offset =  height * color.domain().length / 2; // vertical offset of the entire legend = height of a single element & half the total number of elements
        var horz = 18 * legendRectSize; // the legend is shifted to the left to make room for the text
        var vert = i * height - offset; // the top of the element is hifted up or down from the center using the offset defiend earlier and the index of the current element 'i'
        return 'translate(' + horz + ',' + vert + ')'; //return translation
        });

        // adding colored squares to legend
        legend.append('rect') // append rectangle squares to legend
        .attr('width', legendRectSize) // width of rect size is defined above
        .attr('height', legendRectSize) // height of rect size is defined above
        .style('fill', color) // each fill is passed a color
        .style('stroke', color) // each stroke is passed a color
        .on('click', function(label) {
        var rect = d3.select(this); // this refers to the colored squared just clicked
        var enabled = true; // set enabled true to default
        var totalEnabled = d3.sum(dataset.map(function(d) { // can't disable all options
        return (d.enabled) ? 1 : 0; // return 1 for each enabled entry. and summing it up
        }));

        if (rect.attr('class') === 'disabled') { // if class is disabled
        rect.attr('class', ''); // remove class disabled
        } else { // else
        if (totalEnabled < 2) return; // if less than two labels are flagged, exit
        rect.attr('class', 'disabled'); // otherwise flag the square disabled
        enabled = false; // set enabled to false
        }

        pie.value(function(d) {
        if (d.label === label) d.enabled = enabled; // if entry label matches legend label
          return (d.enabled) ? d.count : 0; // update enabled property and return count or 0 based on the entry's status
        });

        path = path.data(pie(dataset)); // update pie with new data

        path.transition() // transition of redrawn pie
        .duration(750) //
        .attrTween('d', function(d) { // 'd' specifies the d attribute that we'll be animating
          var interpolate = d3.interpolate(this._current, d); // this = current path element
          this._current = interpolate(0); // interpolate between current value and the new value of 'd'
          return function(t) {
            return arc(interpolate(t));
          };
        });
        });

        // adding text to legend
        legend.append('text')
        .attr('x', legendRectSize + legendSpacing)
        .attr('y', legendRectSize - legendSpacing)
        .text(function(d) { return d; }); // return label

  </script>




</html>
